<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>マイタイムテーブル作成</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 手書き風に近い丸文字フォントを読み込み -->
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700;900&display=swap" rel="stylesheet">

  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0?deps=react@18.2.0"
      }
    }
  </script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    .pb-safe { padding-bottom: env(safe-area-inset-bottom, 20px); }
    body { 
      -webkit-tap-highlight-color: transparent;
      font-family: 'Zen Maru Gothic', sans-serif;
    }
    
    .scrollbar-visible::-webkit-scrollbar {
      -webkit-appearance: none;
      height: 10px;
    }
    .scrollbar-visible::-webkit-scrollbar-thumb {
      border-radius: 5px;
      background-color: rgba(99, 102, 241, 0.5);
      border: 2px solid white;
    }
    
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    .force-text-center {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      line-height: 1.2;
    }

    .writing-vertical {
      writing-mode: vertical-rl;
      text-orientation: upright;
    }

    /* スマホ画面表示用のフォント縮小設定（画像生成時はJSで上書き） */
    @media (max-width: 640px) {
      .two-col-group-name {
        font-size: 0.62rem !important;
        letter-spacing: -0.05em;
        white-space: nowrap;
        line-height: 1.1;
      }
      .two-col-time-badge {
        font-size: 0.65rem !important;
        padding: 0px 2px !important;
      }
      .pop-badge-text {
        font-size: 0.55rem !important;
        letter-spacing: -0.1em;
      }
    }

    .font-handwritten {
      font-family: 'Zen Maru Gothic', sans-serif;
      font-weight: 900;
    }
  </style>
</head>
<body class="bg-gray-50 overflow-hidden">
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useMemo, useCallback } from 'react';
    import { createRoot } from 'react-dom/client';
    import { CheckCircle2, Circle, MapPin, AlertTriangle, CalendarRange, ListTodo, Star, Coffee, Sparkles, Download, Loader2, Music } from 'lucide-react';

    function parseTime(timeStr) {
      if (!timeStr) return { start: 0, end: 0 };
      const parts = timeStr.split('-');
      if (parts.length !== 2) return { start: 0, end: 0 };
      const parseHM = (hm) => {
        const [h, m] = hm.split(':').map(Number);
        return h * 60 + m;
      };
      return { start: parseHM(parts[0]), end: parseHM(parts[1]) };
    }

    const scheduleData = [
      { id: 1, stage: "Spotify O-EAST", name: "Palette Parade", time: "10:00-10:30" },
      { id: 2, stage: "Spotify O-EAST", name: "かすみ草とステラ", time: "10:30-11:00" },
      { id: 3, stage: "Spotify O-EAST", name: "LumiUnion", time: "11:00-11:30" },
      { id: 4, stage: "Spotify O-EAST", name: "衛星とカラテア", time: "11:35-12:05" },
      { id: 5, stage: "Spotify O-EAST", name: "fishbowl", time: "12:05-12:35" },
      { id: 6, stage: "Spotify O-EAST", name: "CYNHN", time: "12:35-13:05" },
      { id: 7, stage: "Spotify O-EAST", name: "Sweet Alley", time: "13:10-13:40" },
      { id: 8, stage: "Spotify O-EAST", name: "SUPER☆GiRLS", time: "13:40-14:10" },
      { id: 9, stage: "Spotify O-EAST", name: "fav me", time: "14:10-14:40" },
      { id: 10, stage: "Spotify O-EAST", name: "RE-EE(ニューイヤースターズ)", time: "14:50-15:05" },
      { id: 11, stage: "Spotify O-EAST", name: "ukka", time: "15:05-15:35" },
      { id: 12, stage: "Spotify O-EAST", name: "Devil ANTHEM.", time: "15:35-16:05" },
      { id: 13, stage: "Spotify O-EAST", name: "のんふぃく！", time: "16:05-16:35" },
      { id: 14, stage: "Spotify O-EAST", name: "STU48", time: "16:40-17:10" },
      { id: 15, stage: "Spotify O-EAST", name: "ハルニシオン", time: "17:10-17:40" },
      { id: 16, stage: "Spotify O-EAST", name: "ばってん少女隊", time: "17:40-18:10" },
      { id: 17, stage: "Spotify O-EAST", name: "タイトル未定", time: "18:10-18:40" },
      { id: 18, stage: "Spotify O-EAST", name: "yosugala", time: "18:45-19:20" },
      { id: 19, stage: "Spotify O-EAST", name: "JamsCollection", time: "19:20-19:55" },
      { id: 20, stage: "Spotify O-EAST", name: "iLiFE!", time: "19:55-20:30" },
      { id: 21, stage: "Spotify O-WEST", name: "YOLOZ", time: "10:05-10:35" },
      { id: 22, stage: "Spotify O-WEST", name: "Quubi", time: "10:35-11:05" },
      { id: 23, stage: "Spotify O-WEST", name: "キングサリ", time: "11:05-11:35" },
      { id: 24, stage: "Spotify O-WEST", name: "Luce Twinkle Wink☆", time: "11:40-12:10" },
      { id: 25, stage: "Spotify O-WEST", name: "純情のアフィリア", time: "12:10-12:40" },
      { id: 26, stage: "Spotify O-WEST", name: "点染テンセイ少女。", time: "12:40-13:10" },
      { id: 27, stage: "Spotify O-WEST", name: "22/7 the 3rd", time: "13:15-13:45" },
      { id: 28, stage: "Spotify O-WEST", name: "可憐なアイボリー", time: "13:45-14:15" },
      { id: 29, stage: "Spotify O-WEST", name: "STU48 4期研究生", time: "14:15-14:45" },
      { id: 30, stage: "Spotify O-WEST", name: "LinQ", time: "14:55-15:25" },
      { id: 31, stage: "Spotify O-WEST", name: "Peel the Apple", time: "15:25-15:55" },
      { id: 32, stage: "Spotify O-WEST", name: "MyDearDarlin'", time: "15:55-16:25" },
      { id: 33, stage: "Spotify O-WEST", name: "Onephony", time: "16:30-17:00" },
      { id: 34, stage: "Spotify O-WEST", name: "夜光性アミューズ", time: "17:00-17:30" },
      { id: 35, stage: "Spotify O-WEST", name: "log you", time: "17:30-18:00" },
      { id: 36, stage: "Spotify O-WEST", name: "Merry BAD TUNE.", time: "18:05-18:35" },
      { id: 37, stage: "Spotify O-WEST", name: "Appare!", time: "18:35-19:05" },
      { id: 38, stage: "Spotify O-WEST", name: "なみだ色の消しごむ", time: "19:05-19:35" },
      { id: 39, stage: "Spotify O-WEST", name: "ドラマチックレコード", time: "19:35-20:05" },
      { id: 40, stage: "duo MUSIC EXCHANGE", name: "RINCENT#", time: "10:10-10:40" },
      { id: 41, stage: "duo MUSIC EXCHANGE", name: "Toi Toi Toi", time: "10:40-11:10" },
      { id: 42, stage: "duo MUSIC EXCHANGE", name: "フューチャーサイダー", time: "11:10-11:40" },
      { id: 43, stage: "duo MUSIC EXCHANGE", name: "STAiNY", time: "11:45-12:15" },
      { id: 44, stage: "duo MUSIC EXCHANGE", name: "Pretty Chuu", time: "12:15-12:45" },
      { id: 45, stage: "duo MUSIC EXCHANGE", name: "ドレスコード", time: "12:45-13:15" },
      { id: 46, stage: "duo MUSIC EXCHANGE", name: "NANIMONO", time: "13:20-13:50" },
      { id: 47, stage: "duo MUSIC EXCHANGE", name: "UtaGe!", time: "13:50-14:20" },
      { id: 48, stage: "duo MUSIC EXCHANGE", name: "#Mooove!", time: "14:20-14:50" },
      { id: 49, stage: "duo MUSIC EXCHANGE", name: "Tohkei", time: "15:00-15:30" },
      { id: 50, stage: "duo MUSIC EXCHANGE", name: "Mirror,Mirror", time: "15:30-16:00" },
      { id: 51, stage: "duo MUSIC EXCHANGE", name: "THE ORCHESTRA TOKYO", time: "16:00-16:30" },
      { id: 52, stage: "duo MUSIC EXCHANGE", name: "カラフルスクリーム", time: "16:35-17:05" },
      { id: 53, stage: "duo MUSIC EXCHANGE", name: "FES☆TIVE", time: "17:05-17:35" },
      { id: 54, stage: "duo MUSIC EXCHANGE", name: "MEGAFON", time: "17:35-18:05" },
      { id: 56, stage: "duo MUSIC EXCHANGE", name: "Ringwanderung", time: "18:40-19:10" },
      { id: 57, stage: "duo MUSIC EXCHANGE", name: "INUWASI", time: "19:10-19:40" },
      { id: 58, stage: "duo MUSIC EXCHANGE", name: "ジエメイ", time: "19:40-20:10" },
      { id: 59, stage: "WOMB", name: "I MY ME MINE", time: "10:00-10:30" },
      { id: 60, stage: "WOMB", name: "手羽先センセーション", time: "10:30-10:55" },
      { id: 61, stage: "WOMB", name: "テラテラ", time: "10:55-11:20" },
      { id: 62, stage: "WOMB", name: "SITUASION", time: "11:25-11:50" },
      { id: 63, stage: "WOMB", name: "TENRIN", time: "11:50-12:15" },
      { id: 64, stage: "WOMB", name: "シュレーディンガーの犬", time: "12:15-12:40" },
      { id: 65, stage: "WOMB", name: "Ma'Scar'Piece", time: "12:45-13:10" },
      { id: 66, stage: "WOMB", name: "PRSMIN", time: "13:10-13:35" },
      { id: 67, stage: "WOMB", name: "Kolokol", time: "13:35-14:00" },
      { id: 68, stage: "WOMB", name: "selfish", time: "14:10-14:35" },
      { id: 69, stage: "WOMB", name: "AOAO", time: "14:35-15:00" },
      { id: 70, stage: "WOMB", name: "ラストシーン", time: "15:00-15:25" },
      { id: 71, stage: "WOMB", name: "アップアップガールズ（２）", time: "15:30-15:55" },
      { id: 72, stage: "WOMB", name: "クマリデパート", time: "15:55-16:20" },
      { id: 73, stage: "WOMB", name: "まねきケチャ", time: "16:20-16:45" },
      { id: 74, stage: "WOMB", name: "ワッツ◎さーくる", time: "16:50-17:15" },
      { id: 75, stage: "WOMB", name: "シャルロット", time: "17:15-17:40" },
      { id: 76, stage: "WOMB", name: "#よーよーよー", time: "17:40-18:05" },
      { id: 77, stage: "WOMB", name: "テンシンランマン", time: "18:10-18:35" },
      { id: 78, stage: "WOMB", name: "FULIT BOX", time: "18:35-19:00" },
      { id: 79, stage: "WOMB", name: "SCRAMBLE SMILE", time: "19:00-19:25" },
      { id: 80, stage: "WOMB", name: "メイビーME", time: "19:25-19:50" },
      { id: 81, stage: "clubasia", name: "AZATOY", time: "10:10-10:35" },
      { id: 82, stage: "clubasia", name: "III", time: "10:35-11:00" },
      { id: 83, stage: "clubasia", name: "metarium", time: "11:00-11:25" },
      { id: 84, stage: "clubasia", name: "こみっきゅおん！", time: "11:30-11:55" },
      { id: 85, stage: "clubasia", name: "RE-GE", time: "11:55-12:20" },
      { id: 86, stage: "clubasia", name: "BNSI", time: "12:20-12:45" },
      { id: 87, stage: "clubasia", name: "KOURIN", time: "12:50-13:15" },
      { id: 88, stage: "clubasia", name: "THE ENCORE", time: "13:15-13:40" },
      { id: 89, stage: "clubasia", name: "feelNEO", time: "13:40-14:05" },
      { id: 90, stage: "clubasia", name: "chuLa", time: "14:15-14:40" },
      { id: 91, stage: "clubasia", name: "ナナコロビヤオキ", time: "14:40-15:05" },
      { id: 92, stage: "clubasia", name: "アンスリューム", time: "15:05-15:30" },
      { id: 93, stage: "clubasia", name: "M3LOGIN", time: "15:35-16:00" },
      { id: 94, stage: "clubasia", name: "VVSIS", time: "16:00-16:25" },
      { id: 95, stage: "clubasia", name: "煌めき☆アンフォレント", time: "16:25-16:50" },
      { id: 96, stage: "clubasia", name: "マジカル・パンチライン", time: "16:55-17:20" },
      { id: 97, stage: "clubasia", name: "MAGICAL SPEC", time: "17:20-17:45" },
      { id: 98, stage: "clubasia", name: "Sophià la Mode", time: "17:45-18:10" },
      { id: 99, stage: "clubasia", name: "LilyS/ash", time: "18:15-18:40" },
      { id: 100, stage: "clubasia", name: "ideal peco", time: "18:40-19:05" },
      { id: 101, stage: "clubasia", name: "LINKL PLANET", time: "19:05-19:30" },
      { id: 102, stage: "clubasia", name: "シンデレラ宣言！", time: "19:30-19:55" },
      { id: 103, stage: "SHIBUYA RING", name: "Next☆Rico", time: "10:05-10:30" },
      { id: 104, stage: "SHIBUYA RING", name: "CURE'T", time: "10:30-10:55" },
      { id: 105, stage: "SHIBUYA RING", name: "ワガママなラストノート", time: "10:55-11:20" },
      { id: 106, stage: "SHIBUYA RING", name: "KAMAITACI", time: "11:25-11:50" },
      { id: 107, stage: "SHIBUYA RING", name: "XINXIN", time: "11:50-12:15" },
      { id: 108, stage: "SHIBUYA RING", name: "Cotei", time: "12:15-12:40" },
      { id: 109, stage: "SHIBUYA RING", name: "Hey!Mommy!", time: "12:45-13:10" },
      { id: 110, stage: "SHIBUYA RING", name: "JAPANARIZM", time: "13:10-13:35" },
      { id: 111, stage: "SHIBUYA RING", name: "しろもん", time: "13:35-14:00" },
      { id: 112, stage: "SHIBUYA RING", name: "抜けてるくらいがちょうどいい", time: "14:10-14:35" },
      { id: 113, stage: "SHIBUYA RING", name: "Baby'z Breath", time: "14:35-15:00" },
      { id: 114, stage: "SHIBUYA RING", name: "さよならステイチューン", time: "15:00-15:25" },
      { id: 115, stage: "SHIBUYA RING", name: "ヒロインズ研究生大阪", time: "15:35-16:00" },
      { id: 116, stage: "SHIBUYA RING", name: "限りなく白く", time: "16:00-16:25" },
      { id: 117, stage: "SHIBUYA RING", name: "hakanai", time: "16:25-16:50" },
      { id: 118, stage: "SHIBUYA RING", name: "Axelight", time: "16:55-17:20" },
      { id: 119, stage: "SHIBUYA RING", name: "月に足跡を残した少女達は一体何を見たのか...", time: "17:20-17:45" },
      { id: 120, stage: "SHIBUYA RING", name: "Malcolm Mask McLaren", time: "17:45-18:10" },
      { id: 121, stage: "SHIBUYA RING", name: "AND CaaaLL", time: "18:15-18:40" },
      { id: 122, stage: "SHIBUYA RING", name: "ポンコツコンポ", time: "18:40-19:05" },
      { id: 123, stage: "SHIBUYA RING", name: "ICECREAM SCREAM", time: "19:05-19:30" },
      { id: 124, stage: "SHIBUYA RING", name: "さとりモンスター", time: "19:30-19:55" },
      { id: 125, stage: "Spotify O-Crest", name: "&WHITE", time: "10:05-10:30" },
      { id: 126, stage: "Spotify O-Crest", name: "As a Cutie Pomeranian", time: "10:30-10:55" },
      { id: 127, stage: "Spotify O-Crest", name: "HelloYouth", time: "10:55-11:20" },
      { id: 128, stage: "Spotify O-Crest", name: "ヒロインズ研究生", time: "11:25-11:50" },
      { id: 129, stage: "Spotify O-Crest", name: "Bunny La Crew", time: "11:50-12:15" },
      { id: 130, stage: "Spotify O-Crest", name: "LarmeR", time: "12:15-12:40" },
      { id: 131, stage: "Spotify O-Crest", name: "Sophià la Mode", time: "12:45-13:10" },
      { id: 132, stage: "Spotify O-Crest", name: "ハルニシオン", time: "13:15-13:40" },
      { id: 133, stage: "Spotify O-Crest", name: "Palette Parade", time: "13:40-14:05" },
      { id: 134, stage: "Spotify O-Crest", name: "ちゃーむぼっしゅ", time: "14:15-14:40" },
      { id: 135, stage: "Spotify O-Crest", name: "すてねこキャッツ", time: "14:40-15:05" },
      { id: 136, stage: "Spotify O-Crest", name: "Pastel Closet", time: "15:05-15:30" },
      { id: 137, stage: "Spotify O-Crest", name: "橋を架ける少女", time: "15:35-16:00" },
      { id: 138, stage: "Spotify O-Crest", name: "アキシブproject", time: "16:00-16:25" },
      { id: 139, stage: "Spotify O-Crest", name: "パラディーク", time: "16:25-16:50" },
      { id: 140, stage: "Spotify O-Crest", name: "myojou", time: "16:55-17:20" },
      { id: 141, stage: "Spotify O-Crest", name: "THE ENCORE", time: "17:20-17:45" },
      { id: 142, stage: "Spotify O-Crest", name: "AOAO", time: "17:45-18:10" },
      { id: 143, stage: "Spotify O-Crest", name: "ラナキュラ", time: "18:15-18:40" },
      { id: 144, stage: "Spotify O-Crest", name: "すべての瞬間は君だった。", time: "18:40-19:05" },
      { id: 145, stage: "Spotify O-Crest", name: "Peel the Apple", time: "19:05-19:30" },
      { id: 146, stage: "Spotify O-Crest", name: "Sweet Alley", time: "19:30-19:55" },
      { id: 147, stage: "Spotify O-nest", name: "feelNEO", time: "10:05-10:30" },
      { id: 148, stage: "Spotify O-nest", name: "Tohkei", time: "10:30-10:55" },
      { id: 149, stage: "Spotify O-nest", name: "HIBANA", time: "10:55-11:20" },
      { id: 150, stage: "Spotify O-nest", name: "紫陽花は降らない", time: "11:25-11:50" },
      { id: 151, stage: "Spotify O-nest", name: "himawari(船橋)", time: "11:50-12:15" },
      { id: 152, stage: "Spotify O-nest", name: "すーぱーぷーばぁー!!", time: "12:15-12:40" },
      { id: 153, stage: "Spotify O-nest", name: "diig", time: "12:45-13:10" },
      { id: 154, stage: "Spotify O-nest", name: "月刊PAM", time: "13:10-13:35" },
      { id: 155, stage: "Spotify O-nest", name: "雨模様のソラリス", time: "13:35-14:00" },
      { id: 156, stage: "Spotify O-nest", name: "AdamLilith", time: "14:10-14:35" },
      { id: 157, stage: "Spotify O-nest", name: "KAMAITACI", time: "14:35-15:00" },
      { id: 158, stage: "Spotify O-nest", name: "zanka", time: "15:00-15:25" },
      { id: 159, stage: "Spotify O-nest", name: "かすみ草とステラ(3期生)", time: "15:35-16:00" },
      { id: 160, stage: "Spotify O-nest", name: "透色ドロップ", time: "16:00-16:20" },
      { id: 161, stage: "Spotify O-nest", name: "いつかの夜に僕たちが、", time: "16:20-16:45" },
      { id: 162, stage: "Spotify O-nest", name: "JINKS", time: "16:50-17:15" },
      { id: 163, stage: "Spotify O-nest", name: "iRiNE", time: "17:15-17:40" },
      { id: 164, stage: "Spotify O-nest", name: "Maison de Queen", time: "17:40-18:05" },
      { id: 165, stage: "Spotify O-nest", name: "Melty BeaR", time: "18:10-18:35" },
      { id: 166, stage: "Spotify O-nest", name: "KissBee", time: "18:35-19:00" },
      { id: 168, stage: "Spotify O-nest", name: "ルルネージュ", time: "19:25-19:50" }
    ];

    const stageColors = {
      "Spotify O-EAST": "bg-red-500 text-white",
      "Spotify O-WEST": "bg-orange-500 text-white",
      "duo MUSIC EXCHANGE": "bg-green-500 text-white",
      "WOMB": "bg-pink-500 text-white",
      "clubasia": "bg-blue-500 text-white",
      "SHIBUYA RING": "bg-teal-500 text-white",
      "Spotify O-Crest": "bg-sky-400 text-white",
      "Spotify O-nest": "bg-purple-500 text-white"
    };

    const stageBorderColors = {
      "Spotify O-EAST": "border-red-500",
      "Spotify O-WEST": "border-orange-500",
      "duo MUSIC EXCHANGE": "border-green-500",
      "WOMB": "border-pink-500",
      "clubasia": "border-blue-500",
      "SHIBUYA RING": "border-teal-500",
      "Spotify O-Crest": "border-sky-400",
      "Spotify O-nest": "border-purple-500"
    };

    const stageLightColors = {
      "Spotify O-EAST": "bg-red-500/10",
      "Spotify O-WEST": "bg-orange-500/10",
      "duo MUSIC EXCHANGE": "bg-green-500/10",
      "WOMB": "bg-pink-500/10",
      "clubasia": "bg-blue-500/10",
      "SHIBUYA RING": "bg-teal-500/10",
      "Spotify O-Crest": "bg-sky-400/10",
      "Spotify O-nest": "bg-purple-500/10"
    };

    function App() {
      const [activeTab, setActiveTab] = useState('all');
      const [selections, setSelections] = useState({}); 
      const [gapMemos, setGapMemos] = useState({}); 
      const [songMemos, setSongMemos] = useState({}); 
      const [toastMsg, setToastMsg] = useState('');
      const [userName, setUserName] = useState('');
      const [aspectRatio, setAspectRatio] = useState('9:16');
      const [isGenerating, setIsGenerating] = useState(false);

      const processedSchedule = useMemo(() => {
        return scheduleData.map(item => ({
          ...item,
          parsedTime: parseTime(item.time)
        }));
      }, []);

      const MIN_TIME = useMemo(() => {
        return Math.min(...processedSchedule.map(item => item.parsedTime.start));
      }, [processedSchedule]);

      const stages = useMemo(() => {
        const stageSet = new Set(scheduleData.map(item => item.stage));
        return Array.from(stageSet);
      }, []);

      const busyRanges = useMemo(() => {
        return Object.keys(selections)
          .map(id => {
            const item = processedSchedule.find(p => p.id === parseInt(id));
            return item ? { ...item.parsedTime, stage: item.stage } : null;
          })
          .filter(Boolean);
      }, [selections, processedSchedule]);

      const recommendedCount = Object.values(selections).filter(v => v === 'recommended').length;

      const toggleSelection = (id) => {
        setSelections(prev => {
          const current = prev[id];
          const next = { ...prev };
          if (!current) {
            next[id] = 'normal';
          } else if (current === 'normal') {
            const currentRecommendedCount = Object.values(prev).filter(v => v === 'recommended').length;
            if (currentRecommendedCount >= 5) {
              setToastMsg('おすすめの選択は5グループまでです！');
              setTimeout(() => setToastMsg(''), 3000);
              delete next[id];
            } else {
              next[id] = 'recommended';
            }
          } else {
            delete next[id];
          }
          return next;
        });
      };

      const handleMemoChange = (gapKey, text) => {
        setGapMemos(prev => ({ ...prev, [gapKey]: text }));
      };

      const handleSongChange = (id, text) => {
        setSongMemos(prev => ({ ...prev, [id]: text }));
      };

      const handleDownload = async () => {
        setIsGenerating(true);
        try {
          const sourceElement = document.getElementById('my-schedule-content');
          if (!sourceElement) return;

          const exportWidth = 720; 
          const isMobileDevice = window.innerWidth < 640;
          
          const wrapper = document.createElement('div');
          wrapper.style.width = `${exportWidth}px`;
          wrapper.style.backgroundColor = '#f9fafb';
          wrapper.style.position = 'fixed';
          wrapper.style.left = '-9999px';
          wrapper.style.top = '0';
          wrapper.style.zIndex = '-1';
          wrapper.style.display = 'flex';
          wrapper.style.flexDirection = 'column';

          const clone = sourceElement.cloneNode(true);
          clone.style.width = '100%';
          clone.style.height = 'auto'; 
          clone.style.paddingBottom = '40px'; 
          
          const headerArea = clone.querySelector('.header-content-area');
          if (headerArea) {
            const inputField = sourceElement.querySelector('.name-input-field');
            const nameValue = inputField.value || '名前';
            headerArea.innerHTML = '';
            const combinedRow = document.createElement('div');
            combinedRow.className = 'w-full flex items-center justify-center gap-6 py-6 bg-white';
            combinedRow.innerHTML = `
              <span class="export-text-lift text-[20px] font-black text-indigo-900">IDORISE!! FESTIVAL 2026</span>
              <span class="export-text-lift px-3 py-1 bg-indigo-500 text-white rounded font-bold text-[12px]">Day1: 3/7(土)</span>
              <span class="export-text-lift text-[18px] font-bold text-gray-800">${nameValue} のタイテ</span>
            `;
            headerArea.appendChild(combinedRow);
          }

          const isHorizontalMode = aspectRatio === '9:16' || isMobileDevice;

          const columns = clone.querySelectorAll('.timeline-column');
          columns.forEach(col => {
            col.style.width = (isHorizontalMode || columns.length === 1) ? '680px' : '350px';
            col.style.flexShrink = '0';
          });
          
          const timelineContainer = clone.querySelector('.timeline-outer-container');
          if (timelineContainer) {
            timelineContainer.style.display = 'flex';
            timelineContainer.style.flexDirection = isHorizontalMode ? 'column' : 'row';
            timelineContainer.style.alignItems = 'center';
            timelineContainer.style.justifyContent = 'center';
            timelineContainer.style.gap = '5px';
            timelineContainer.style.padding = '0 5px';
          }

          const cardBodies = clone.querySelectorAll('.image-card-body');
          cardBodies.forEach(body => {
             body.classList.remove('flex-col');
             body.classList.add('flex-col', 'items-center', 'justify-center');
             
             if (isHorizontalMode) {
                body.style.flexDirection = 'row';
                body.style.justifyContent = 'space-between';
                body.style.paddingLeft = '12px';
                body.style.paddingRight = '12px';
             }

             const metaRow = body.querySelector('.image-meta-row');
             if (metaRow) {
                metaRow.classList.add('justify-center', 'w-full');
                if (isHorizontalMode) {
                  metaRow.style.width = 'auto';
                  metaRow.style.marginRight = '20px';
                } else {
                  metaRow.style.marginBottom = '6px';
                }
                metaRow.style.gap = '10px';
             }
             
             const nameContainer = body.querySelector('.image-name-container');
             if (nameContainer) {
                nameContainer.classList.add('items-center', 'justify-center', 'w-full');
                nameContainer.style.marginTop = '0';
                nameContainer.style.paddingRight = '0';
                
                const nameText = nameContainer.querySelector('.two-col-group-name');
                if (nameText) {
                   nameText.style.textAlign = 'center';
                   nameText.style.width = '100%';
                   nameText.style.lineHeight = '1.5';
                   if (isMobileDevice) {
                      nameText.style.fontSize = '36px'; 
                   }
                }
             }

             const songContainer = body.querySelector('.song-container-for-image');
             if (songContainer) {
                songContainer.classList.add('justify-center', 'w-full');
                if (!isHorizontalMode) songContainer.style.marginTop = '6px';
                if (isMobileDevice) {
                   songContainer.style.fontSize = '12px';
                }
             }
          });

          const replaceInputWithDiv = (selector, defaultValue = '', placeholderAsDefault = false) => {
            const originalInputs = sourceElement.querySelectorAll(selector);
            const clonedInputs = clone.querySelectorAll(selector);
            originalInputs.forEach((input, index) => {
              const clonedInput = clonedInputs[index];
              if (!clonedInput) return;
              let val = input.value || (placeholderAsDefault ? input.placeholder : defaultValue);
              const textDiv = document.createElement('div');
              textDiv.textContent = val;
              textDiv.className = clonedInput.className;
              textDiv.style.border = 'none';
              textDiv.style.backgroundColor = 'transparent';
              textDiv.style.display = 'flex';
              textDiv.style.alignItems = 'center';
              textDiv.style.justifyContent = 'center';
              textDiv.style.lineHeight = '1.8'; 
              textDiv.style.color = input.value ? 'inherit' : '#9ca3af';
              textDiv.style.overflow = 'visible'; 
              textDiv.style.width = '100%';
              if (selector.includes('song-input')) {
                textDiv.style.fontSize = '11px';
              }
              clonedInput.parentNode.insertBefore(textDiv, clonedInput);
              clonedInput.style.display = 'none';
            });
          };
          replaceInputWithDiv('input.memo-input-field', '', true);
          replaceInputWithDiv('input.song-input-field', '', true);

          const allTextDivs = clone.querySelectorAll('.export-text-lift, .two-col-group-name');
          allTextDivs.forEach(div => {
             div.style.overflow = 'visible';
             div.style.whiteSpace = 'nowrap';
          });

          const textLifts = clone.querySelectorAll('.export-text-lift');
          textLifts.forEach(el => {
            el.style.position = 'relative';
            el.style.top = '-5.5px';
          });

          clone.querySelectorAll('button[aria-label="削除"]').forEach(btn => btn.style.display = 'none');

          wrapper.appendChild(clone);
          document.body.appendChild(wrapper);

          const measuredHeight = clone.offsetHeight + 100;

          const canvas = await html2canvas(wrapper, { 
            scale: 2, 
            useCORS: true,
            backgroundColor: '#f9fafb',
            width: exportWidth,
            height: measuredHeight, 
            logging: false
          });

          document.body.removeChild(wrapper);
          const url = canvas.toDataURL('image/png');
          const a = document.createElement('a');
          a.href = url;
          a.download = `my_timetable_${aspectRatio.replace(':', '_')}.png`;
          a.click();
        } catch (error) {
          console.error('画像生成エラー:', error);
        } finally {
          setIsGenerating(false);
        }
      };

      const renderAllTimeTable = () => {
        const PIXELS_PER_MINUTE = 3;
        const STICKY_HEADER_HEIGHT = 24;

        return (
          <div className="flex flex-col h-full overflow-hidden">
            <div className="px-4 py-1 flex-none bg-white/80 backdrop-blur-sm z-20">
              {toastMsg && (
                <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full mb-2 bg-gray-800 text-white text-xs px-4 py-2 rounded-full shadow-lg z-50 flex items-center gap-2">
                  <AlertTriangle size={14} className="text-yellow-400" />
                  {toastMsg}
                </div>
              )}
              <div className="flex items-center justify-between">
                <p className="text-gray-600 text-[10px] m-0 text-ellipsis overflow-hidden whitespace-nowrap mr-2 font-bold tracking-tight">タップで選択 / 通常→おすすめ切替</p>
                <div className="relative inline-flex items-center justify-center z-10 px-1.5 py-0.5 bg-yellow-100 border border-yellow-200 rounded shrink-0">
                  <div className="flex items-center gap-1">
                    <Star size={10} className="fill-yellow-500 text-yellow-500" />
                    <span className="text-[10px] font-bold text-yellow-800 leading-none">おすすめ {recommendedCount}/5</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="flex-1 overflow-x-auto scrollbar-visible mt-1 px-4 relative">
              <div className="flex flex-row gap-3 min-w-max h-full overflow-y-auto pb-32 hide-scrollbar relative scrollbar-visible">
                <div className="absolute top-0 left-0 w-full pointer-events-none z-0">
                  {busyRanges.map((range, i) => (
                    <div
                      key={i}
                      className={`absolute w-full border-y border-black/5 ${stageLightColors[range.stage] || 'bg-indigo-500/10'}`}
                      style={{
                        top: `${STICKY_HEADER_HEIGHT + 6 + (range.start - MIN_TIME) * PIXELS_PER_MINUTE}px`,
                        height: `${(range.end - range.start) * PIXELS_PER_MINUTE}px`
                      }}
                    />
                  ))}
                </div>

                {stages.map(stage => {
                  const stageItems = processedSchedule
                    .filter(item => item.stage === stage)
                    .sort((a, b) => a.parsedTime.start - b.parsedTime.start);
                  if (stageItems.length === 0) return null;
                  let previousEndTime = MIN_TIME;
                  return (
                    <div key={stage} className="w-[80vw] sm:w-[280px] flex-shrink-0 flex flex-col bg-white/40 rounded-xl shadow-sm border border-gray-100 overflow-visible h-fit min-h-full z-10 text-ellipsis">
                      <div className={`px-3 py-1 font-bold flex items-center gap-1.5 sticky top-0 z-30 text-xs rounded-t-xl ${stageColors[stage] || 'bg-gray-800 text-white'}`} style={{ height: `${STICKY_HEADER_HEIGHT}px` }}>
                        <MapPin size={14} />
                        <span className="truncate">{stage}</span>
                      </div>
                      <div className="p-1.5 flex-1 relative bg-transparent">
                        {stageItems.map(item => {
                          const selectionStatus = selections[item.id];
                          const isSelected = !!selectionStatus;
                          const stageColorClass = stageColors[stage] || 'bg-gray-800 text-white';
                          const gap = item.parsedTime.start - previousEndTime;
                          const duration = item.parsedTime.end - item.parsedTime.start;
                          previousEndTime = item.parsedTime.end;
                          return (
                            <React.Fragment key={item.id}>
                              {gap > 0 && <div style={{ height: `${gap * PIXELS_PER_MINUTE}px` }} className="w-full" aria-hidden="true" />}
                              <button 
                                onClick={() => toggleSelection(item.id)}
                                style={{ height: `${duration * PIXELS_PER_MINUTE}px` }}
                                className={`w-full text-left px-1.5 py-0 rounded-md flex items-center justify-between transition-all active:scale-[0.98] border overflow-hidden
                                  ${isSelected ? `${stageColorClass} shadow-md border-transparent` : 'bg-white border-gray-200 hover:border-gray-300 hover:shadow-sm'}`}
                              >
                                <div className="flex flex-col justify-center h-full w-full pr-1 overflow-hidden text-ellipsis whitespace-nowrap">
                                  <span className={`text-[9px] font-mono whitespace-nowrap leading-none mb-0.5 ${isSelected ? 'text-white/80' : 'text-gray-500'}`}>{item.time}</span>
                                  <span className={`font-bold text-[10px] leading-tight text-left ${isSelected ? 'text-white' : 'text-gray-900'}`}>{item.name}</span>
                                </div>
                                <div className="flex-shrink-0">
                                  {!isSelected && <Circle className="text-gray-300" size={14} />}
                                  {selectionStatus === 'normal' && <CheckCircle2 className="text-white" size={14} />}
                                  {selectionStatus === 'recommended' && <Star className="text-yellow-300 fill-yellow-300" size={14} />}
                                </div>
                              </button>
                            </React.Fragment>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        );
      };

      const renderTimeline = (scheduleItems, offsetIndex, isTwoColumn) => {
        return (
          <div className={`relative pt-2 pb-6 space-y-1.5 timeline-column ${isTwoColumn ? 'flex-1 min-w-0 px-[0.25%]' : 'w-full max-w-xl mx-auto px-1'}`}>
            <div className={`flex flex-col gap-1.5 sm:gap-2`}>
            {scheduleItems.map((item, localIndex) => {
              const globalIndex = offsetIndex + localIndex;
              let isOverlapping = false;
              let gapMinutes = 0;
              let gapKey = null;

              const myScheduleSorted = processedSchedule
                .filter(si => selections[si.id])
                .sort((a, b) => a.parsedTime.start - b.parsedTime.start);

              if (globalIndex < myScheduleSorted.length - 1) {
                const nextItem = myScheduleSorted[globalIndex + 1];
                if (item.parsedTime.end > nextItem.parsedTime.start) isOverlapping = true;
                else {
                  gapMinutes = nextItem.parsedTime.start - item.parsedTime.end;
                  gapKey = `${item.id}-${nextItem.id}`;
                }
              }
              const borderColor = stageBorderColors[item.stage] || 'border-gray-800';
              const badgeColor = stageColors[item.stage] || 'bg-gray-800 text-white';
              const isRecommended = selections[item.id] === 'recommended';

              return (
                <React.Fragment key={item.id}>
                  <div className="relative pr-0">
                    <div className={`rounded-xl flex flex-row relative border border-gray-200 shadow-sm overflow-hidden min-h-[58px] transition-all
                      ${isRecommended ? 'bg-gradient-to-br from-white via-white to-pink-50/30' : 'bg-white'}`}>

                      {isRecommended && (
                        <div className="w-5 sm:w-6 bg-gradient-to-b from-pink-100 via-pink-200 to-orange-100 flex flex-col items-center justify-start py-1.5 shrink-0 border-r border-pink-200/50 shadow-inner">
                           <div className="w-3.5 h-3.5 bg-white/90 rounded-full flex items-center justify-center mb-1 shadow-sm">
                              <Star size={9} className="fill-pink-400 text-pink-400" />
                           </div>
                           <div className="writing-vertical flex items-center justify-center font-handwritten">
                             <span className="export-text-lift text-[8.5px] sm:text-[10px] font-black text-pink-600 tracking-tighter pop-badge-text">おすすめ</span>
                           </div>
                        </div>
                      )}

                      <div className={`image-card-body flex-1 p-2 sm:p-2.5 flex flex-col border-l-4 ${borderColor} min-w-0`}>
                         <div className="image-meta-row flex items-center gap-1 sm:gap-2 mb-1 h-5 overflow-hidden shrink-0">
                            <div className={`px-1.5 py-0.5 rounded shadow-sm force-text-center h-full bg-gray-100/80`}>
                              <span className="export-text-lift font-mono font-bold text-[8.5px] sm:text-[11px] leading-none text-gray-700 two-col-time-badge">{item.time}</span>
                            </div>
                            <div className={`px-2 py-0.5 rounded-full shadow-sm force-text-center h-full max-w-[55%] ${badgeColor}`}>
                              <span className="export-text-lift text-[7.5px] sm:text-[10px] font-bold whitespace-nowrap overflow-hidden leading-none two-col-label">{item.stage.replace('Spotify ', '')}</span>
                            </div>
                         </div>

                         <div className="image-name-container relative pr-6 mt-1 flex-1 flex flex-col justify-center min-w-0">
                            <div className={`font-bold leading-[1.3] export-text-lift overflow-visible two-col-group-name text-gray-900 ${isRecommended ? 'font-black' : ''}`}>
                              {item.name}
                            </div>
                            {isRecommended && !isGenerating && (
                              <div className="mt-1 flex items-center gap-1 p-0.5 px-1 bg-white/70 border border-pink-100 rounded-md overflow-hidden min-h-[16px]">
                                <Music size={8} className="text-pink-300 shrink-0" />
                                {/* ★案1：defaultValue + onBlur 方式に変更 */}
                                <input 
                                  type="text"
                                  placeholder="曲名入力"
                                  defaultValue={songMemos[item.id] || ''}
                                  onBlur={(e) => handleSongChange(item.id, e.target.value)}
                                  className="song-input-field text-[8.5px] font-bold bg-transparent w-full focus:outline-none placeholder-pink-100 text-pink-900 export-text-lift leading-none"
                                />
                              </div>
                            )}
                            {isRecommended && isGenerating && (
                              <div className="song-container-for-image mt-1.5 flex items-center gap-1 overflow-visible">
                                 <Music size={10} className="text-pink-300 shrink-0" />
                                 <span className="text-[12px] font-bold text-pink-900">{songMemos[item.id]}</span>
                              </div>
                            )}
                         </div>
                         
                         {isOverlapping && (
                          <div className="mt-1 px-1.5 py-0 bg-red-50 border border-red-100 rounded flex items-center gap-0.5 w-max h-4 force-text-center">
                            <AlertTriangle size={8} className="text-red-600" />
                            <span className="export-text-lift text-[7.5px] sm:text-[9.5px] font-bold text-red-600 leading-none">被り</span>
                          </div>
                         )}

                         <button onClick={() => setSelections(prev => { const next = {...prev}; delete next[item.id]; return next; })} className="absolute top-1 right-1 p-1 text-gray-300 hover:text-red-500 transition-colors" aria-label="削除"><span className="text-[12px] font-bold">×</span></button>
                      </div>

                      {/* おすすめ装飾帯（右） */}
                      {isRecommended && (
                        <div className="w-5 sm:w-6 bg-gradient-to-b from-pink-100 via-pink-200 to-orange-100 shrink-0 border-l border-pink-200/50 shadow-inner">
                        </div>
                      )}
                    </div>
                  </div>

                  {gapMinutes >= 15 && gapKey && (
                    <div className="relative py-0.5">
                      <div className="relative p-1 px-2 flex items-center gap-2 bg-gray-50 border border-gray-100 rounded-lg shadow-sm h-7 sm:h-8 mx-0.5">
                        <div className="flex items-center gap-0.5 text-gray-500 whitespace-nowrap h-full shrink-0"><Coffee size={10} /><span className="export-text-lift text-[8.5px] sm:text-[10px] font-bold text-gray-700 leading-none">{gapMinutes}分 空き</span></div>
                        {/* ★案1：defaultValue + onBlur 方式に変更 */}
                        <input 
                          type="text" 
                          placeholder="メモ入力" 
                          defaultValue={gapMemos[gapKey] || ''} 
                          onBlur={(e) => handleMemoChange(gapKey, e.target.value)} 
                          className="memo-input-field text-[8.5px] sm:text-[10px] bg-white border border-gray-200 rounded px-1.5 py-0.5 w-full focus:outline-none focus:ring-1 focus:ring-indigo-500 export-text-lift h-full" 
                        />
                      </div>
                    </div>
                  )}
                </React.Fragment>
              );
            })}
            </div>
          </div>
        );
      };

      const renderMyTimeTable = () => {
        const selectedCount = Object.keys(selections).length;
        if (selectedCount === 0) {
          return (
            <div className="max-w-lg mx-auto px-4 flex flex-col items-center justify-center py-20 text-gray-400 text-center">
              <CalendarRange size={48} className="mb-4 opacity-50 mx-auto" />
              <p>まだアイドルが選択されていません。</p>
              <button onClick={() => setActiveTab('all')} className="mt-6 px-6 py-2 bg-indigo-600 text-white rounded-full font-medium shadow-sm">一覧から選ぶ</button>
            </div>
          );
        }

        const mySchedule = processedSchedule
          .filter(item => selections[item.id])
          .sort((a, b) => a.parsedTime.start - b.parsedTime.start);
        const isTwoColumn = aspectRatio === '3:4' && mySchedule.length >= 10;

        return (
          <div className={`mx-auto pb-24 h-full overflow-y-auto w-full scrollbar-visible`}>
            {/* ツールバー */}
            <div className="flex flex-col sm:flex-row items-center justify-between bg-white p-2 rounded-xl shadow-sm border border-gray-100 mb-2 mt-2 mx-auto max-w-xl gap-3">
              <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-lg w-full sm:w-auto">
                <button 
                  onClick={() => setAspectRatio('9:16')}
                  className={`flex-1 sm:flex-none px-3 py-1.5 text-[10px] sm:text-xs font-bold rounded-md transition-all ${aspectRatio === '9:16' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500'}`}
                >
                  スマホ向け
                </button>
                <button 
                  onClick={() => setAspectRatio('3:4')}
                  className={`flex-1 sm:flex-none px-3 py-1.5 text-[10px] sm:text-xs font-bold rounded-md transition-all ${aspectRatio === '3:4' ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500'}`}
                >
                  SNS向け
                </button>
              </div>
              <button onClick={handleDownload} disabled={isGenerating} className="flex items-center justify-center gap-1 px-4 py-2 bg-indigo-600 text-white text-xs font-bold rounded-lg hover:bg-indigo-700 disabled:bg-indigo-300 transition-colors shadow-sm w-full sm:w-auto">
                {isGenerating ? <Loader2 size={14} className="animate-spin" /> : <Download size={14} />}
                {isGenerating ? '生成中...' : '画像生成'}
              </button>
            </div>

            <div id="my-schedule-content" className="bg-gray-50 flex flex-col w-full h-full relative pt-8 sm:pt-12">
              <div className="bg-white border-b border-gray-200 shrink-0 header-content-area overflow-hidden py-4 text-center">
                <div className="flex flex-col items-center justify-center gap-2 w-full px-1">
                   <div className="flex items-center gap-1.5 shrink-0 h-6">
                      <h2 className="text-[14px] sm:text-[16px] font-black text-indigo-900 tracking-tight m-0 whitespace-nowrap export-text-lift">IDORISE!! FESTIVAL 2026</h2>
                      <div className="px-1.5 py-0 bg-indigo-500 rounded-sm flex items-center justify-center h-4.5 translate-y-[1px]">
                         <span className="export-text-lift text-[9px] sm:text-[10px] font-bold text-white leading-none">Day1: 3/7(土)</span>
                      </div>
                   </div>
                   <div className="name-input-container border-b-2 border-indigo-300 px-1 flex items-center h-7 min-w-[120px] justify-center font-sans font-bold">
                      <input 
                        type="text" 
                        placeholder="名前を入力" 
                        value={userName} 
                        onChange={(e) => setUserName(e.target.value)} 
                        className="name-input-field text-[14px] font-bold text-center pr-0.5 text-gray-800 bg-transparent w-[80px] focus:outline-none placeholder-gray-300" 
                        maxLength="15" 
                      />
                      <span className="text-[12px] font-bold text-gray-600 whitespace-nowrap flex items-center h-full">
                        <span className="export-text-lift text-node"> のタイテ</span>
                      </span>
                   </div>
                </div>
              </div>
              <div className={`flex timeline-outer-container ${isTwoColumn ? 'flex-row items-start justify-center gap-[1px] px-[1px] py-4' : 'flex-col items-center py-4 px-2'}`}>
                {isTwoColumn ? (
                  <>
                    {renderTimeline(mySchedule.slice(0, Math.ceil(mySchedule.length / 2)), 0, true)}
                    {renderTimeline(mySchedule.slice(Math.ceil(mySchedule.length / 2)), Math.ceil(mySchedule.length / 2), true)}
                  </>
                ) : (
                  renderTimeline(mySchedule, 0, false)
                )}
              </div>
            </div>
          </div>
        );
      };

      return (
        <div className="h-screen flex flex-col overflow-hidden text-gray-900 font-sans">
          <header className="bg-white px-4 py-2 shadow-sm z-50 flex-none border-b border-gray-100">
            <h1 className="flex flex-row items-center justify-center gap-2 text-indigo-900">
              <span className="text-sm sm:text-base font-black tracking-tight whitespace-nowrap">IDORISE!! FESTIVAL 2026</span>
              <div className="flex flex-row items-center gap-1.5 h-5">
                <div className="px-1.5 py-0 text-[9px] font-bold text-indigo-600 bg-indigo-50 rounded border border-indigo-100 whitespace-nowrap flex items-center justify-center h-full">
                   <span className="export-text-lift">Day1: 3/7(土)</span>
                </div>
                <span className="text-[9px] font-normal text-gray-500 whitespace-nowrap leading-none pt-0.5 flex items-center h-full">
                   <span className="export-text-lift text-node font-sans"> by ドルオタボックス</span>
                </span>
              </div>
            </h1>
          </header>
          <main className="flex-1 overflow-hidden pb-16">{activeTab === 'all' ? renderAllTimeTable() : renderMyTimeTable()}</main>
          <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 pb-safe z-50">
            <div className="max-w-lg mx-auto flex">
              <button onClick={() => setActiveTab('all')} className={`flex-1 py-3 flex flex-col items-center gap-0.5 transition-colors ${activeTab === 'all' ? 'text-indigo-600' : 'text-gray-400 hover:text-gray-600'}`}><ListTodo size={18} /><span className="text-[10px] font-bold">全ステージ一覧</span></button>
              <button onClick={() => setActiveTab('mine')} className={`flex-1 py-3 flex flex-col items-center gap-0.5 transition-colors relative ${activeTab === 'mine' ? 'text-indigo-600' : 'text-gray-400 hover:text-gray-600'}`}><div className="relative"><CalendarRange size={18} />{Object.keys(selections).length > 0 && <span className="absolute -top-1 -right-2 bg-red-500 text-white text-[9px] font-bold w-3.5 h-3.5 rounded-full flex items-center justify-center">{Object.keys(selections).length}</span>}</div><span className="text-[10px] font-bold">マイスケジュール</span></button>
            </div>
          </div>
        </div>
      );
    }
    createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>